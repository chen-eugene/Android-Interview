### 第四章：网络层

#### 1、网络层设计思路：网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。

   好处就是网络造价大大降低，运行方式灵活，能够适应多种应用。
     
#### 2、将网络互相连接起来要使用一些中间设备：
 
  - 物理层使用的中间设备叫**转发器**。
  - 数据链路层使用的中间设备叫**网桥**或**桥接器**。
  - 网络层使用的中间设备叫**路由器**。
  - 在网络层以上使用的中间设备叫**网关**。用网关连接两个不兼容的系统需要在高层进行协议转换。

#### 3、 虚拟互联网络

   图4-3(a)表示有许多计算机网络通过一些路由器进行互连。由于参加互连的计算机网络都使用相同的**网络协议IP（International Protocol）**，因此可以把互连以后的计算机网络看成如图4-3（b）所示的一个**虚拟互连网络（internet）**。所谓虚拟互连网络也就是逻辑互连网络，它的意思就是互连起来的各种物理网络的异构性本来是客观存在的，但是我们利用IP协议就可以使这些性能各异的网络**在网络层上看起来好像是一个统一的网络**。这种使用IP协议的虚拟互连网络可简称为**IP网**（IP网是虚拟的，但平常不必每次都强调“虚拟”二字）。
    
   使用IP网的好处是：当IP网上的主机进行通信时，就好像在一个单个网络上通信一样，它们看不见互连的各网络的具体异构细节（如具体的编址方案、路由器选择协议，等等）。如果在这种覆盖全球的IP网的上层使用TCP协议，那么就是现在的互联网（Internet）。   
   
![虚拟互联网络](https://github.com/chen-eugene/Interview/blob/master/image/84734854472343465496.png)


#### 4、分类IP地址：

   所谓“分类的IP地址”就是将IP地址划分成若干个固定类，每一个地址由两个固定长度的字段组成，其中第一个字段是**网络号(net-id)** ，它标志主机（或路由器）所连接到的网络。一个网络号在整个互联网范围内必须是唯一的。第二个字段是**主机号(host-id)** ，它标志该主机（或路由器）。一台主机在它前面的网络号所指明的网络范围内必须是唯一的。由此可见，**一个IP地址在整个互联网范围内是唯一的**。 
 
  IP地址空间共有2^32个地址，A类地址空间共有2^31个，占50%；B类地址空间共有2^30个，占25%；C类地址空间共有2^29个，占12.5%。
 
 ![IP地址](https://github.com/chen-eugene/Interview/blob/master/image/weurudsoifj.png)
 
#### 5、子网掩码：从IP数据包的首部无法看出源主机或目的主机所连接的网络是否进行了子网的划分。这是因为32位的IP地址本身以及数据报的首部都没有包含任何有关子网划分的信息。子网掩码的作用就是不管网络有没有划分子网，只要把子网掩码和IP地址进行逐位的 “与”运算(AND)，就能立即得出网络地址来。
  
  ![子网掩码](https://github.com/chen-eugene/Interview/blob/master/image/1541426783(1).png)
  
#### 6、分层次的路由选择协议

  由于① 互联网的规模非常大。 ② 许多单位不愿意外界了解自己单位网络的布局细节和本部门所采用的路由选择协议，但同时还希望连接到互联网上。 为此可以把整个互联网划分为许多较小的自治系统(autonomous system)AS。
  
  互联网把路由选择协议划分为两大类：
  
  - 内部网关协议IGP(Interior Gateway Protocol) 即在一个自治系统内部使用的路由选择协议，而这与互联网中的其他自治系统选用的什么路由选择协议无关。目前这类路由选择协议使用的最懂，如RIP和OSPF协议。
  
  - 外部网关协议EGP(External Gateway Protocol) 若源主机和目的主机处在不同的资质系统中（这两个自治系统可能使用不同的内部网关协议），但数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议EGP。目前使用最多的外部网关协议是BGP的版本4(BGP-4)。

 

